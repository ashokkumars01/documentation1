{% extends "!layout.html" %}

{% block footer %}
  {{ super() }}

  <script>
    fetch("/versions.json")
      .then(r => r.json())
      .then(versions => {
        const current = location.pathname.split("/")[1];
        const select = document.createElement("select");
        select.id = "version-switcher";

        versions.forEach(v => {
          const opt = document.createElement("option");
          opt.value = v.name;
          opt.textContent = v.name;
          if (v.name === current) opt.selected = true;
          select.appendChild(opt);
        });

        select.onchange = () => {
          const v = select.value;
          const rest = location.pathname.split("/").slice(2).join("/");
          location.href = "/" + v + "/" + rest;
        };

        document.body.appendChild(select);
      });
  </script>
{% endblock %}
{% block extrahead %}
    {{ super() }}
    <link rel="stylesheet" href="{{ pathto('_static/version_switch.css', 1) }}" />
    <script src="{{ pathto('_static/version_switcher.js', 1) }}"></script>
{% endblock %}

